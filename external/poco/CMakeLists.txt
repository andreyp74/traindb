cmake_minimum_required(VERSION 3.2)
project(poco_builder C CXX)
include(ExternalProject)

ExternalProject_Add(poco
    URL https://github.com/pocoproject/poco/archive/poco-1.7.9-release.zip
    URL_MD5 3228c1c370fa99924cd89afc00242058
    CMAKE_ARGS -DENABLE_XML:BOOL=ON
               -DENABLE_JSON:BOOL=ON
               -DENABLE_UTIL:BOOL=ON
               -DENABLE_MONGODB:BOOL=OFF
               -DENABLE_POCODOC:BOOL=OFF
               -DENABLE_TESTS:BOOL=OFF
               -DENABLE_CRYPTO:BOOL=OFF
               -DENABLE_NETSSL:BOOL=OFF
               -DENABLE_NET:BOOL=ON
               -DENABLE_DATA:BOOL=OFF
               -DENABLE_DATA_SQLITE:BOOL=OFF
               -DENABLE_DATA_MYSQL:BOOL=OFF
               -DENABLE_DATA_ODBC:BOOL=OFF
               -DENABLE_ZIP:BOOL=OFF
               -DENABLE_CPPPARSER:BOOL=OFF
               -DPOCO_DLL:BOOL=ON
               -DCMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG:PATH=${CMAKE_BINARY_DIR}/Debug
               -DCMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE:PATH=${CMAKE_BINARY_DIR}/Release
 
    PREFIX "${CMAKE_CURRENT_BINARY_DIR}"
    UPDATE_COMMAND ""
    PATCH_COMMAND ""
    INSTALL_COMMAND ""
    DOWNLOAD_DIR "${CMAKE_SOURCE_DIR}/.downloaded"
)

# Specify include dir
ExternalProject_Get_Property(poco SOURCE_DIR)
ExternalProject_Get_Property(poco BINARY_DIR)

set(POCO_INCLUDE_DIRS 
  ${SOURCE_DIR}/Foundation/include
  ${SOURCE_DIR}/Util/include
  ${SOURCE_DIR}/Net/include
  ${SOURCE_DIR}/NetSSL_OpenSSL/include
  ${SOURCE_DIR}/XML/include
  ${SOURCE_DIR}/JSON/include
  ${SOURCE_DIR}/Crypto/include
  ${SOURCE_DIR}/Data/include
  ${SOURCE_DIR}/Data/ODBC/include
  ${SOURCE_DIR}/Zip/include
  ${SOURCE_DIR}/CppUnit/include
  ${SOURCE_DIR}/CppParser/include
  ${SOURCE_DIR}/PageCompiler/include
  PARENT_SCOPE
)

set(POCO_LIBRARY_DIRS ${BINARY_DIR}/lib PARENT_SCOPE)
set(POCO_BINARY_DIRS ${BINARY_DIR}/bin PARENT_SCOPE)

set(POCO_LIBRARIES  
  ${CMAKE_SHARED_LIBRARY_PREFIX}PocoFoundation${CMAKE_SHARED_LIBRARY_SUFFIX}
  ${CMAKE_SHARED_LIBRARY_PREFIX}PocoUtil${CMAKE_SHARED_LIBRARY_SUFFIX}
  ${CMAKE_SHARED_LIBRARY_PREFIX}PocoXML${CMAKE_SHARED_LIBRARY_SUFFIX}
  ${CMAKE_SHARED_LIBRARY_PREFIX}PocoJSON${CMAKE_SHARED_LIBRARY_SUFFIX}
  ${CMAKE_SHARED_LIBRARY_PREFIX}PocoNet${CMAKE_SHARED_LIBRARY_SUFFIX}
  ${CMAKE_SHARED_LIBRARY_PREFIX}PocoNetSSL${CMAKE_SHARED_LIBRARY_SUFFIX}
  ${CMAKE_SHARED_LIBRARY_PREFIX}PocoCrypto${CMAKE_SHARED_LIBRARY_SUFFIX}
  ${CMAKE_SHARED_LIBRARY_PREFIX}PocoZip${CMAKE_SHARED_LIBRARY_SUFFIX}
  ${CMAKE_SHARED_LIBRARY_PREFIX}PocoData${CMAKE_SHARED_LIBRARY_SUFFIX}
PARENT_SCOPE)

